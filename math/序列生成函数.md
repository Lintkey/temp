## 应用范围

计算集合元素的组合数/排列数

## 基本运算

设序列 $a,b$ 对应的生成函数分别为 $A(x),B(x)$，则：

1. 序列之和的生成函数为 $A(x)+B(x)$
2. 序列卷积的生成函数为 $A(x)B(x)$

按照分析视角，有3类生成函数，三者分析的视角、运算不同。由于序列与普通生成函数封闭形式之间有良好的对应关系(**Z**变换)，这里只介绍普通生成函数，下面简称GF

## 生成函数GF

$$
G(x)=\sum_{n=0}^{\infin 或 m}g[n]x^n
$$

生成函数的封闭形式刚好就是对应序列的**Z**变换($x=z^{-1}$)，其中共轭、反转性质一般用不上，常用的是移序、比例、缩放、差分、卷积性质

统一下描述，令 $g[n],n\ge 0$ 表示序列 $\langle g[0],g[1],g[2]\cdots\rangle$，$G(x)$ 是其对应的生成函数/**Z**变换($x$ 就是**Z**变换中的 $z^{-1}$)，那么有：

1. 移序：$g[n-n_0]\lrarr x^{n_0}G(x)$
2. 比例：$r^ng[n]\lrarr G(rx)$
3. 缩放：$g[n/k]\lrarr G(x^k)$，$g[n/k]=\begin{cases}g[\frac nk]&n=ik,i\in\mathbb N\\0&ohter\end{cases}$
4. (函数)差分：$n^kg[n+k]\lrarr G^{(k)}(x)$
5. 卷积：$(g*h)[n]\lrarr G(x)H(x)$

常用序列对应GF的封闭形式(对应**Z**变换)：

1. $\delta[n]=[n=0]\lrarr 1$
2. $\mu[n]=[n\ge 0]\lrarr\frac 1{1-x}$，(无限移序求和，收敛域 $|x|<1$ 因此 $x^\infin=0$)
3. $\mu[n]-\mu[n-n_0]\lrarr\frac{1-x^n_0}{1-x}$，序列相消
4. $\sum_{i=0}^{n_0-1}\delta[n-i]\lrarr\sum_{i=0}^{n_0-1}x^i=\frac{1-x_0^n}{1-x}$，移序求和
5. $c_m=\langle\binom m0,\binom m1,\cdots,\binom mm\rangle\lrarr(1+x)^m$，二项式定理
6. $c^k=\langle\binom kk,\binom {k+1}k,\binom {k+2}k,\cdots\rangle\lrarr\frac 1{(1-x)^{k+1}}$，广义二项式定理。结合卷积性和GF式子可发现序列为 $k+1$ 个 $\mu[n]$ 的卷积。每次和 $\mu[n]$ 卷积都相当于做一次前缀和，画个杨辉三角就能发现 $\mu[n]$ 对应三角的左斜边，一次卷积/前缀和后相当于斜向下移动一次
7. $e[n]=\langle\frac 1{0!},\frac 1{1!},\frac 1{2!},\cdots\rangle\lrarr e^x$，$e^x|_{x_0=0}$ 泰勒展开

> (7)式和指数生成函数功效差不多，用于配合计算多重集(有同种元素的集合)排列数：假设集合元素有 $M$ 个，第 $i$ 种元素有 $m_i$ 个，那么该集合的排列数为 $\frac {M!}{\prod_i(m_i!)}$，该集合选 $n$ 个元素的排列数**除去分子**对应的生成函数，就是 $\prod_i(\sum_{n=0}^{m_i}\frac 1{n!}x^n)$，当同种元素无限制时，就为 $\prod_iE_i(x)$

寻找序列公式的方向有两个：

1. 使用已有序列和性质组合寻找
2. 求GF的封闭形式，然后反求序列公式

### 练习

求下列数列对应GF的封闭形式及序列公式

1. $\langle 1,-1,1,-1,\cdots\rangle$
   
   很简单，对 $\mu[n]$ 使用比例性 $r=-1$，那么对应的GF就是 $\frac 1{1+x}$
   
   $g[n]=(-1)^n\mu[n]$

2. $\langle 1,1,1,2,2,2,3,3,3,\cdots\rangle$
   
   $\mu[n]$ 差分得到 $\langle 1,2,3,\cdots\rangle$，再缩放 $k=3$ 得到 $\langle 1,0,0,2,0,0,3,0,0,\cdots\rangle$，最后移序求和得到目标序列，那么对应的函数变化过程是：$\frac 1{1-x}\rarr\frac 1{(1-x)^2}\rarr\frac 1{(1-x^3)^2}\rarr\frac{1-x^3}{1-x}\frac 1{(1-x^3)^2}=\frac 1{(1-x)(1-x^3)}$
   
   另一种思路是看作 $\sum_{i=0}\mu[n-3i]$，也就是 $\mu[n]$ 移序3求和，那么对应的就是 $\frac 1{1-x}\rarr \frac {1-x^{\infin}}{1-x^3}\frac 1{1-x}$，函数的收敛域为 $|x|<1$，因此这里分子为 $1$
   
   使用第二种思路求 $g[n]$，$g[n]=\sum_{i=0} \mu[n-3i]=\left\lceil\frac{n+1}3\right\rceil$

3. $\langle 1,1,2,3,5,8,13,\cdots\rangle$ 即斐波那契数列
   
   已知 $fib[n]=fib[n-1]+fib[n-2],n\ge 2$，因此使用序列相消可得 $\delta[n]=fib[n]-fib[n-1]-fib[n-2]\lrarr G(x)-xG(x)-x^2G(x)=1$，整理一下右边的等式可得 $G(x)=\frac 1{1-x-x^2}$
   
   使用部分分式展开法可得：$G(x)=\frac{r_0}{\sqrt 5}\frac 1{1-r_0x}-\frac{r_1}{\sqrt 5}\frac 1{1-r_1x},r_0=\frac{1+\sqrt 5}2,r_1=\frac{1-\sqrt 5}2$，结合比例性可知 $g[n]=\frac {r_0}{\sqrt 5}r_0^n\mu[n]-\frac {r_1}{\sqrt 5}r_1^n\mu[n]=\frac 1{\sqrt 5}\left((\frac{1+\sqrt 5}2)^{n+1}-(\frac{1-\sqrt 5}2)^{n+1}\right)\mu[n]$

由GF求对应序列的公式或计算方法

1. $G(x)=\frac x{(1-x)^4}$
   
   由广义二项式定理可知：$\binom {n+3}3\lrarr\frac 1{(1-x)^4}$
   
   再由移序性可得：$\binom {n+2}3\lrarr\frac x{(1-x)^4}$
   
   因此序列公式为：$g[n]=\binom {n+2}3$

2. $E(x)=e^{2x}\left(\frac{e^x+e^{-x}}2\right)^2$
   
   整理得 $E(x)=\frac{e^{4x}}4+\frac{e^{2x}}2+\frac 14$
   
   由比例性可知 $\frac{r^n}{n!}\lrarr e^{rx}$
   
   因此序列公式为：$e[n]=\frac {4^n+2\cdot 2^n+[n=0]}{4\cdot n!}$

## 例题

1. [POJ3734]长度为 $n$ 的序列，用红黄蓝绿四种颜色填涂，求红与黄填涂次数均为偶数的方案数

   带限制的多重集排列计数

   + 蓝绿随便选，因此对分母的生成函数为 $E_0(x)=e^x$
   + 红与黄只能选偶数次，对应序列就是只有偶次项，因此对分母的生成函数为 $E_1(x)=\frac{e^x-e^{-x}}2$
   + 那么总体对分母的生成函数就是 $E(x)=E_0^2(x)E_1^2(x)$

   最后的练习就是求该生成函数的对应序列公式，乘上多重集排列计数公式的分子 $n!$，可得答案为 $4^{n-1}+2^{n-1}+\frac{[n=0]}4$

2. [HDU7328]有 $n$ 个不同字符，每次可将两个不同字符/串拼接成串(带顺序，可在拼接时指定)，单个串长度上界为 $k$，求拼接了任意次后存在 $m$ 个串的状况数，结果对 $998244353$ 取模

   这题集合内元素种数与个数相同，但是对合并有上界限制

   + 单个长度为 $n$ 的串分母序列为 $\mu[n-1],n>0$，考虑长度 $k$ 的限制，应为 $\mu[n-1]-\mu[n-k-1],n>0$，对应的生成函数为 $E_0(x)=\frac{x-x^{k+1}}{1-x}=\frac{x(1-x^k)}{1-x}$
   + 那么 $m$ 个串就是 $E(x)=x^m\left(\frac{1-x^k}{1-x}\right)^m$，因此答案就是 $\left(\frac{1-x^k}{1-x}\right)^m$ 对应序列的第 $n-m$ 项乘上 $n!$，序列的某项可以直接根据GF展开算(把 $(1-x^k)^m$ 和 $\frac 1{(1-x)^m}$二项式展开，找幂次和为 $n-m$ 的项求系数乘积之和)

3. [[牛客23多校8B]](https://ac.nowcoder.com/acm/contest/57362/B)求点数为 $n$，最大有向环长度为 $k$ 的竞赛图数量。图论方面的推导不是本篇重点，略。题目等价求最大强连通分量大小为 $k$ 的 $n$ 点竞赛图数量。

   和2.一样，排列问题，合并有上界限制，但是这题单个集合的GF不好找

   + 假设 $F(x)$ 是大小上界为 $m$ 的强连通竞赛图数量分母的GF，那么答案分母的GF就是 $\sum_{i=1}^nF^i(x)=\frac{F(x)}{1-F(x)}$ 的第 $n$ 项系数乘 $n!$
   + 竞赛图数量分母的GF为 $G(x)=\sum_{n=1}^\infin\binom n2\frac{x^n}{n!}$，通过容斥可得到无上界的强连通竞赛图数量分母的GF，即：
      $$
      -\sum_{n=1}^{\infin}(-1)^nG^i(x)=1-\sum_{n=0}^{\infin}(-1)^nG^i(x)=1-\frac 1{1+G(x)}
      $$
      截取 $0\sim m$ 项即可得到 $F(x)$
   + 另外，由于询问的 $n>0$ 可以注意到答案的GF加上常数项 $1$ 并不影响答案，此时得到GF为 $\frac 1{1-F(x)}$，而 $1-F(x)$ 为 $\frac 1{1+G(x)}$，这样计算答案的过程就避免了不必要的多项式乘法，只需两次求逆即可

## 扩展

### 五边形数定理

$$
\prod_{i=1}^\infin(1-x^i)=\sum_{k=0}^\infin(-1)^kx^{k(3k\pm 1)/2}
$$
